{% extends "base.html" %}
{% load dict_extras %}
{% block content %}
{% load humanize %}
<div class="container py-4">
  <div class="row mb-3">
    <div class="col-md-8">
      <h4 class="mb-0">ููุญุฉ ุงูุชุญูู ุงููุงููุฉ</h4>
      {% comment %} <p class="text-muted mt-2">
        ุนุฑุถ ุดุงูู ูุฃุฑุตุฏุฉ ุงูุดุฑูุฉุ ููุฎุต ุดุฑุงุก ุงูุนููุงุชุ ูุงุณุชุซูุงุฑุงุช ูุณุญูุจุงุช ุงูุดุฑูุงุก.<br>
        ุฌููุน ุงูุจูุงูุงุช ูุชุฑุงุจุทุฉ ููููู ุฅุฏุงุฑุชูุง ูู ููุง.
      </p> {% endcomment %}
    </div>
    {% comment %} <div class="col-md-4 text-end">
      <a href="{% url 'company_balances' %}" class="btn btn-outline-info ms-2" title="ุนุฑุถ ุฃุฑุตุฏุฉ ุงูุดุฑูุฉ ุญุณุจ ุงูุนููุฉ">ุฃุฑุตุฏุฉ ุงูุดุฑูุฉ</a>
      <a href="{% url 'currency_purchases_list' %}" class="btn btn-outline-info ms-2" title="ุณุฌู ุดุฑุงุก ุงูุนููุงุช">ุณุฌู ุดุฑุงุก ุงูุนููุงุช</a>
      <a href="{% url 'partners_list' %}" class="btn btn-outline-info ms-2" title="ุฅุฏุงุฑุฉ ุงูุดุฑูุงุก">ุงูุดุฑูุงุก</a>
      <a href="{% url 'operation_history' %}" class="btn btn-outline-info" title="ุณุฌู ุงูุนูููุงุช ุงููุงููุฉ">ุณุฌู ุงูุนูููุงุช</a>
    </div> {% endcomment %}
  </div>
  <div class="row">
    <div class="col-md-12">
      <!-- Real-time balances by currency -->
      <div class="card shadow mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0  text-white">ุฃุฑุตุฏุฉ ุงูุดุฑูุฉ ุญุณุจ ุงูุนููุฉ</h5>
        </div>
        <div class="card-body">
          <table class="table table-bordered align-middle">
            <thead class="table-light">
              <tr>
                <th>ุงูุนููุฉ</th>
                <th>ุงูุฑุตูุฏ</th>
                <th>ูุง ูุนุงุฏู ุจุงูุฌููู <span title="ุญุณุจ ุณุนุฑ ุงูุตุฑู ุงููุณุฌู">๐</span></th>
              </tr>
            </thead>
            <tbody>
              {% for b in balances_sdg %}
              <tr>
                <td>{{ b.currency }}</td>
                <td>{{ b.balance|floatformat:0|intcomma }}</td>
                <td>{{ b.sdg_equiv|floatformat:0|intcomma }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="3" class="text-center text-muted">ูุง ุชูุฌุฏ ุนููุงุช ูุณุฌูุฉ.</td>
              </tr>
              {% endfor %}
              <tr class="table-info summary">
                <td>ุฅุฌูุงูู ุจุงูุฌููู</td>
                <td></td>
                <td>{{ balances_total_sdg|floatformat:0|intcomma }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- Currency purchase summary -->
      <div class="card shadow mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0  text-white">ููุฎุต ุดุฑุงุก ุงูุนููุงุช</h5>
        </div>
        <div class="card-body">
          <table class="table table-bordered align-middle">
            <thead class="table-light">
              <tr>
                <th>ุงูุนููุฉ</th>
                <th>ุฅุฌูุงูู ุงูุดุฑุงุก</th>
                <th>ุฅุฌูุงูู ุงูุชูููุฉ ุจุงูุฌููู</th>
              </tr>
            </thead>
            <tbody>
              {% for p in purchase_summary %}
              <tr>
                <td>{{ p.currency__code }}</td>
                <td>{{ p.total_amount|floatformat:0|default:"0"|intcomma }}</td>
                <td>{{ p.total_sdg_cost|floatformat:0|intcomma }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="3" class="text-center text-muted">ูุง ุชูุฌุฏ ุนูููุงุช ุดุฑุงุก ุนููุฉ.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <!-- Partner investments and withdrawals -->
      <div class="card shadow">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0  text-white">ุงูุดุฑูุงุก</h5>
        </div>
        <div class="card-body">
          <table class="table table-bordered align-middle">
            <thead class="table-light">
              <tr>
                <th>ุงูุงุณู</th>
                <th>ุงููุจุงูุบ ุงูููุฏุนุฉ</th>
                <th>ุงููุณุญูุจุงุช</th>
              </tr>
            </thead>
            <tbody>
              {% for partner in partners %}
              <tr>
                <td>{{ partner.full_name }}</td>
                <td>{{ deposits_per_partner|dict_get:partner.id|floatformat:0|default:"0"|intcomma }}</td>
                <td>{{ withdrawals_per_partner|dict_get:partner.id|floatformat:0|default:"0"|intcomma }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="3" class="text-center text-muted">ูุง ููุฌุฏ ุดุฑูุงุก.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <!-- Financial logs section for transparency -->
      <div class="card shadow mt-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0 text-white">ุณุฌู ุงูุนูููุงุช ุงููุงููุฉ (ุขุฎุฑ 50 ุนูููุฉ)</h5>
        </div>
        <div class="card-body">
          <table class="table table-bordered align-middle">
            <thead class="table-light">
              <tr>
                <th>#</th>
                <th>ุงูุนูููุฉ</th>
                <th>ุงููุตู</th>
                <th>ุงููุจูุบ</th>
                <th>ุงูุนููุฉ</th>
                <th>ูุง ูุนุงุฏู ุจุงูุฌููู</th>
                <th>ุงูุชุงุฑูุฎ</th>
              </tr>
            </thead>
            <tbody>
              {% for log in logs %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ log.get_operation_type_display }}</td>
                <td>{{ log.description }}</td>
                <td>{{ log.amount|floatformat:0|intcomma }}</td>
                <td>{% if log.currency %}{{ log.currency.code }}{% else %}-{% endif %}</td>
                <td>{{ log.sdg_equivalent|floatformat:0|intcomma }}</td>
                <td>{{ log.timestamp|date:"Y-m-d H:i" }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted">ูุง ุชูุฌุฏ ุนูููุงุช ูุณุฌูุฉ.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
